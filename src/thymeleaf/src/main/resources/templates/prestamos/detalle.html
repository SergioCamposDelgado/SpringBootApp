<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/main :: layout(~{::section})}">

<body>
    <section>
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8">
                <div class="card shadow">
                    <div class="card-header bg-info text-white d-flex justify-content-between">
                        <h4 class="mb-0">
                            <i class="bi bi-info-circle"></i> Detalle del Préstamo #<span
                                th:text="${prestamo.id}"></span>
                        </h4>
                        <a th:href="@{/prestamos/mios}" class="btn btn-outline-light btn-sm">
                            <i class="bi bi-arrow-left"></i> Volver
                        </a>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5><strong>Usuario:</strong> <span
                                        th:text="${prestamo.usuario.nombreCompleto} + ' (' + ${prestamo.usuario.email} + ')'"></span>
                                </h5>
                                <p><strong>Libro:</strong> <span th:text="${prestamo.libro.titulo}"></span></p>
                                <p><strong>Autor:</strong> <span
                                        th:text="${prestamo.libro.autor?.nombre + ' ' + prestamo.libro.autor?.apellido} ?: 'Sin autor'"></span>
                                </p>
                                <p><strong>ISBN:</strong> <span th:text="${prestamo.libro.isbn}"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Fecha Préstamo:</strong> <span
                                        th:text="${#temporals.format(prestamo.fechaPrestamo, 'dd/MM/yyyy')}"></span></p>
                                <p><strong>Fecha Prevista:</strong> <span
                                        th:text="${#temporals.format(prestamo.fechaDevolucionPrevista, 'dd/MM/yyyy')}"></span>
                                </p>
                                <p><strong>Fecha Real Devolución:</strong>
                                    <span
                                        th:text="${prestamo.fechaDevolucionReal != null} ? ${#temporals.format(prestamo.fechaDevolucionReal, 'dd/MM/yyyy')} : 'Pendiente'"></span>
                                </p>
                                <p><strong>Estado:</strong>
                                    <span th:switch="${prestamo.estado.name()}">
                                        <span th:case="'ACTIVO'" class="badge bg-primary">Activo</span>
                                        <span th:case="'DEVUELTO'" class="badge bg-success">Devuelto</span>
                                        <span th:case="'VENCIDO'" class="badge bg-danger">Vencido</span>
                                        <span th:case="'CANCELADO'" class="badge bg-secondary">Cancelado</span>
                                        <span th:case="*">Desconocido</span>
                                    </span>
                                </p>
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- Acciones si activo -->
                        <div th:if="${prestamo.estado.name() == 'ACTIVO'}">
                            <a th:href="@{/prestamos/devolver/{id}(id=${prestamo.id})}" class="btn btn-success me-2"
                                th:onclick="'return confirm(\\'¿Devolver el libro?\\')'">
                                <i class="bi bi-check-circle"></i> Devolver
                            </a>

                            <a th:href="@{/prestamos/cancelar/{id}(id=${prestamo.id})}" class="btn btn-warning"
                                th:onclick="'return confirm(\\'¿Cancelar préstamo?\\')'">
                                <i class="bi bi-x-circle"></i> Cancelar
                            </a>
                        </div>

                        <div th:if="${prestamo.estado.name() == 'DEVUELTO'}">
                            <div class="alert alert-success">
                                Este préstamo ya está devuelto
                            </div>
                        </div>
						

						<div th:if="${prestamo.estado.name() == 'CANCELADO'}">
						    <div class="alert alert-secondary">
						        Este préstamo ya está cancelado.
						    </div>
						</div>
						
						<div th:if="${prestamo.estado.name() == 'VENCIDO'}">
						    <div class="alert alert-danger">
						        Este préstamo ya está vencido. Contacte con administracion para devolver el libro
						    </div>
						</div>

                        <div class="mt-4">
                            <a th:href="@{/prestamos/mios}" class="btn btn-outline-secondary">
                                Volver a Mis Préstamos
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>

</html>