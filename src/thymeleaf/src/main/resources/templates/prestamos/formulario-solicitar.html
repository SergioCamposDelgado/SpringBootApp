<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      th:replace="~{layout/main :: layout(~{::section})}">

<body>
    <section>
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">
                            <i class="bi bi-journal-bookmark"></i> 
                            Confirmar Solicitud de Préstamo
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            Estás solicitando préstamo del siguiente libro:
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-8">
                                <h5 class="fw-bold" th:text="${prestamo.libro.titulo}"></h5>
                                <p><strong>Autor:</strong> 
                                    <span th:text="${prestamo.libro.autor?.nombre + ' ' + prestamo.libro.autor?.apellido} ?: 'Sin autor'"></span>
                                </p>
                                <p><strong>ISBN:</strong> <span th:text="${prestamo.libro.isbn}"></span></p>
                                <p><strong>Año:</strong> <span th:text="${prestamo.libro.añoPublicacion} ?: 'No especificado'"></span></p>
                            </div>
                            <div class="col-md-4 text-center">
                                <div class="bg-light border rounded p-4" style="height: 200px; display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-book display-1 text-secondary"></i>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-warning">
                            <strong>Condiciones del préstamo:</strong>
                            <ul class="mb-0">
                                <li>Duración: 14 días</li>
                                <li>Fecha prevista de devolución: 
                                    <strong th:text="${#temporals.format(#temporals.createNow().plusDays(14), 'dd/MM/yyyy')}"></strong>
                                </li>
                                <li>Si no se devuelve a tiempo, se marcará como vencido</li>
                            </ul>
                        </div>

                        <hr class="my-4">

                        <form th:action="@{/prestamos/solicitar}" method="post">
                            <!-- Campos ocultos: enviamos los IDs directamente (sin binding completo) -->
                            <input type="hidden" name="libro.id" th:value="${prestamo.libro.id}" />
                            <input type="hidden" name="usuario.id" th:value="${prestamo.usuario.id}" />

                            <div class="d-flex justify-content-between">
                                <a th:href="@{/libros/{id}(id=${prestamo.libro.id})}" class="btn btn-outline-secondary">
                                    <i class="bi bi-arrow-left"></i> Cancelar
                                </a>
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-check-circle"></i> Confirmar Solicitud
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>
</html>